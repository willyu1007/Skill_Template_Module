# GitLab CI template (baseline for this template repo)
# - Runs repo verification suites (no package manager required)
# - Installs python3 (required by some suites)
#
# - Optional: run `node .ai/skills/features/ci/scripts/cictl.mjs init` to create `ci/config.json` metadata
#
# NOTE: If you need project-specific test suites (api/web/perf/mobile), add jobs and map them to deterministic commands.

stages:
  - verify

repo-verification:
  stage: verify
  image: node:20-bullseye
  before_script:
    - apt-get update
    - apt-get install -y python3
    - node --version
    - python3 --version
  script:
    - node .ai/scripts/lint-skills.mjs --strict
    - node .ai/scripts/lint-docs.mjs
    - node .ai/tests/run.mjs --suite environment
    - node .ai/tests/run.mjs --suite iac
    - node .ai/tests/run.mjs --suite database
    - node .ai/tests/run.mjs --suite deployment
    - node .ai/tests/run.mjs --suite context-awareness
    - node .ai/tests/run.mjs --suite modular-system
    - node .ai/tests/run.mjs --suite ui
  artifacts:
    when: on_failure
    paths:
      - .ai/.tmp/test-evidence/
    expire_in: 7 days
