# Example: User Management Integration Scenarios
#
# Copy relevant scenarios into `modules/integration/scenarios.yaml`.
# After editing, run:
#   node .ai/scripts/modules/integrationctl.mjs validate
#   node .ai/scripts/modules/integrationctl.mjs compile

scenarios:
  # ============================================================================
  # Active Scenarios (endpoints implemented)
  # ============================================================================

  - id: create-and-retrieve-user
    name: "Create and Retrieve User"
    description: "Create a new user, then retrieve it by ID to verify persistence"
    flow_id: user-management
    status: active

    steps:
      - name: create-user
        flow_node: create-user
        endpoint_id: "example-api:http-api.create-user"
        input:
          email: "test@example.com"
          name: "Test User"
        expect:
          status: 201
          json_path_exists:
            - "id"
            - "email"
            - "name"
            - "createdAt"
          json_path_equals:
            email: "test@example.com"
            name: "Test User"

      - name: get-user
        flow_node: get-user
        endpoint_id: "example-api:http-api.get-user"
        expect:
          status: 200
          json_path_equals:
            email: "test@example.com"

  - id: create-and-list-users
    name: "Create and List Users"
    description: "Create a user, then verify it appears in the user list"
    flow_id: user-management
    status: active

    steps:
      - name: create-user
        flow_node: create-user
        endpoint_id: "example-api:http-api.create-user"
        input:
          email: "listtest@example.com"
          name: "List Test User"
        expect:
          status: 201

      - name: list-users
        flow_node: list-users
        endpoint_id: "example-api:http-api.list-users"
        expect:
          status: 200
          body_contains:
            - "listtest@example.com"

  # ============================================================================
  # Draft Scenarios (allow_unresolved for planned nodes)
  # ============================================================================

  - id: user-lifecycle-update-path
    name: "User Lifecycle - Update Path"
    description: "Create user, retrieve, then update"
    flow_id: user-management
    status: draft
    allow_unresolved: true

    steps:
      - name: create-user
        flow_node: create-user
        endpoint_id: "example-api:http-api.create-user"
        input:
          email: "lifecycle@example.com"
          name: "Lifecycle User"
        expect:
          status: 201

      - name: get-user
        flow_node: get-user
        endpoint_id: "example-api:http-api.get-user"
        expect:
          status: 200

      - name: update-user
        flow_node: update-user
        allow_unresolved: true
        # No endpoint yet - this node is planned
        input:
          name: "Updated Name"
        expect:
          status: 200

  - id: user-lifecycle-delete-path
    name: "User Lifecycle - Delete Path"
    description: "Create user, retrieve, then delete"
    flow_id: user-management
    status: draft
    allow_unresolved: true

    steps:
      - name: create-user
        flow_node: create-user
        endpoint_id: "example-api:http-api.create-user"
        input:
          email: "delete-test@example.com"
          name: "Delete Test User"
        expect:
          status: 201

      - name: get-user
        flow_node: get-user
        endpoint_id: "example-api:http-api.get-user"
        expect:
          status: 200

      - name: delete-user
        flow_node: delete-user
        allow_unresolved: true
        # No endpoint yet - this node is planned
        expect:
          status: 204
