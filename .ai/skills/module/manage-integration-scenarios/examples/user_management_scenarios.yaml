# Example: User Management Integration Scenarios
#
# Copy relevant scenarios into `modules/integration/scenarios.yaml`.
# After editing, run:
#   node .ai/scripts/integrationctl.js validate
#   node .ai/scripts/integrationctl.js compile

scenarios:
  # ============================================================================
  # Active Scenarios (endpoints implemented)
  # ============================================================================

  - id: create_and_retrieve_user
    name: "Create and Retrieve User"
    description: "Create a new user, then retrieve it by ID to verify persistence"
    flow_id: user_management
    status: active

    steps:
      - name: create_user
        flow_node: create_user
        endpoint_id: "example.api:http_api.create_user"
        input:
          email: "test@example.com"
          name: "Test User"
        expect:
          status: 201
          json_path_exists:
            - "id"
            - "email"
            - "name"
            - "createdAt"
          json_path_equals:
            email: "test@example.com"
            name: "Test User"

      - name: get_user
        flow_node: get_user
        endpoint_id: "example.api:http_api.get_user"
        expect:
          status: 200
          json_path_equals:
            email: "test@example.com"

  - id: create_and_list_users
    name: "Create and List Users"
    description: "Create a user, then verify it appears in the user list"
    flow_id: user_management
    status: active

    steps:
      - name: create_user
        flow_node: create_user
        endpoint_id: "example.api:http_api.create_user"
        input:
          email: "listtest@example.com"
          name: "List Test User"
        expect:
          status: 201

      - name: list_users
        flow_node: list_users
        endpoint_id: "example.api:http_api.list_users"
        expect:
          status: 200
          body_contains:
            - "listtest@example.com"

  # ============================================================================
  # Draft Scenarios (allow_unresolved for planned nodes)
  # ============================================================================

  - id: user_lifecycle_update_path
    name: "User Lifecycle - Update Path"
    description: "Create user, retrieve, then update"
    flow_id: user_management
    status: draft
    allow_unresolved: true

    steps:
      - name: create_user
        flow_node: create_user
        endpoint_id: "example.api:http_api.create_user"
        input:
          email: "lifecycle@example.com"
          name: "Lifecycle User"
        expect:
          status: 201

      - name: get_user
        flow_node: get_user
        endpoint_id: "example.api:http_api.get_user"
        expect:
          status: 200

      - name: update_user
        flow_node: update_user
        allow_unresolved: true
        # No endpoint yet - this node is planned
        input:
          name: "Updated Name"
        expect:
          status: 200

  - id: user_lifecycle_delete_path
    name: "User Lifecycle - Delete Path"
    description: "Create user, retrieve, then delete"
    flow_id: user_management
    status: draft
    allow_unresolved: true

    steps:
      - name: create_user
        flow_node: create_user
        endpoint_id: "example.api:http_api.create_user"
        input:
          email: "delete-test@example.com"
          name: "Delete Test User"
        expect:
          status: 201

      - name: get_user
        flow_node: get_user
        endpoint_id: "example.api:http_api.get_user"
        expect:
          status: 200

      - name: delete_user
        flow_node: delete_user
        allow_unresolved: true
        # No endpoint yet - this node is planned
        expect:
          status: 204

