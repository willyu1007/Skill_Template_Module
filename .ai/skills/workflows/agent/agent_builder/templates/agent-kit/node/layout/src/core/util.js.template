const fs = require('fs');
const path = require('path');

function readJson(filePath) {
  const txt = fs.readFileSync(filePath, 'utf8');
  return JSON.parse(txt);
}

function safeReadJson(filePath, fallback = null) {
  try { return readJson(filePath); } catch (e) { return fallback; }
}

function writeJson(filePath, obj) {
  fs.mkdirSync(path.dirname(filePath), { recursive: true });
  fs.writeFileSync(filePath, JSON.stringify(obj, null, 2) + '\n', 'utf8');
}

function approxTokenCount(text) {
  // Rough heuristic: ~4 chars per token (English-ish). Adjust if needed.
  if (!text) return 0;
  return Math.ceil(String(text).length / 4);
}

function nowIso() {
  return new Date().toISOString();
}

module.exports = {
  readJson,
  safeReadJson,
  writeJson,
  approxTokenCount,
  nowIso
};
