# Skill: initialize-project-from-requirements

The skill connects the flow from **requirements docs → project blueprint → scaffold/configs → skill sync**, and records an auditable initialization state so every stage has a clear **validation + user approval** checkpoint.

Goal: a robust, repeatable, rollback-friendly initialization workflow (not the fastest possible iteration).

---

## Inputs

### Stage A (requirements docs, required)

Located under `init/stage-a-docs/` (or the `--docs-root` you provide):

- `init/stage-a-docs/requirements.md`
- `init/stage-a-docs/non-functional-requirements.md`
- `init/stage-a-docs/domain-glossary.md`
- `init/stage-a-docs/risk-open-questions.md`

### Stage B (blueprint, required)

- `init/project-blueprint.json`

**Note**: After initialization completes, use `cleanup-init --archive` to archive these to `docs/project/` for long-term preservation.

### Core capability: Context system (built-in)

In the module-first template, the Context system is a **built-in capability** (no longer installed from `addons/context-awareness`).

Default behavior:
- `contextAwareness` is the enable/disable switch for the core capability. Unless the blueprint explicitly disables `addons.contextAwareness: false`, the built-in steps run:
  - `node .ai/scripts/projectctl.js init`
  - `node .ai/scripts/projectctl.js set-context-mode <contract|snapshot>`
  - `node .ai/scripts/contextctl.js init`
  - `node .ai/scripts/contextctl.js build`
- Optional: if `init-pipeline.cjs apply` is run with `--verify-addons`, it also runs `node .ai/scripts/contextctl.js verify`

---

## Outputs (written artifacts)

### Stage A

- Requirements docs (`init/stage-a-docs/*`)
- Init state file: `init/.init-state.json`

### Stage B

- Blueprint: `init/project-blueprint.json`

### Stage C

- **`README.md`** (root) - **overwrite**: Generated from blueprint. Rollback via `git checkout README.md` if needed.
- Scaffolded directory structure (examples):
  - `src/` or `apps/` + `packages/` (based on `repo.layout`)
  - `docs/diagrams/` (if diagram capability is enabled)
  - `ops/` (created by DevOps scaffold and/or add-on installation; see below)
- Config files (generated by `scripts/scaffold-configs.cjs`): e.g. `.gitignore`, lint/test/format configs (based on the blueprint)
- Add-ons (when enabled in the blueprint; default ON for packaging/deployment/release/observability):
  - copies payloads from `addons/<addonId>/payload/` into repo root (idempotent copy-if-missing)
  - typical directories: `ops/packaging/`, `ops/deploy/`, `release/`, `observability/`
- Skills selection (SSOT):
  - `.ai/skills/_meta/sync-manifest.json` (flat schema: `version/includePrefixes/includeSkills/excludeSkills`)
  - Add-on mode: if `.ai/scripts/skillsctl.js` exists, pack toggles MUST be applied via skillsctl (scheme A)
- Provider wrapper generation/update:
  - `node .ai/scripts/sync-skills.cjs` (supports `--providers`)

**Blast radius warning**: Stage C `apply` will overwrite `README.md` and may create/modify config files and add-on directories. Commit or stash changes before running.

### Context system outputs (built-in)

When `contextAwareness` is not explicitly disabled (enabled by default) and `apply` is executed, the following core artifacts are ensured/generated:

- `.ai/scripts/contextctl.js`
- `.ai/scripts/projectctl.js`
- `docs/context/` (context registries, workflows, etc.; maintained by built-in scripts)

Note: the Context system is not installed from `addons/`. Even if `addons.contextAwareness: false` is set, these files remain part of the template core; the init/build/verify steps are just skipped.

---

## Critical process rules (MUST)

1. Every stage transition MUST have "validation + user approval".
   - Validation is recorded by script commands in `init/.init-state.json`.
   - Advancing stages MUST be done via the explicit `approve` command (do not hand-edit the state file to skip stages).
2. Do not advance stages without explicit user approval.
3. **No workdocs during initialization**: Do NOT create workdocs task bundles during the init workflow. The init pipeline has its own state tracking. Workdocs are intended for post-init development tasks only.
4. Context system (core capability) enable switch:
    - `addons.contextAwareness` is the built-in enable switch; default is enabled unless explicitly `false`.
    - The pipeline does not install Context from `/addons/<addonId>/payload` (Context is not an add-on; it is core).
    - Non-core add-ons (packaging/deployment/release/observability) ARE installed from `addons/` when enabled in the blueprint.
    - `blueprint.context.*` is configuration-only; the setting does not trigger installation.
5. The manifest schema MUST be the "flat schema".
   - Do not use `collections.current` or similar nested structures.
6. Single source of truth for config generation: `scripts/scaffold-configs.cjs`.
7. **Add-ons default ON**: All optional add-ons (packaging, deployment, release, observability) are **enabled by default**. Use opt-out model (ask user to disable, not enable).
8. **Phase 6 documentation update is REQUIRED**: After `apply` completes, the LLM MUST ask the user whether to update **both** `README.md` and `AGENTS.md` with tech stack info. See `templates/llm-init-guide.md` Phase 6.
9. **Phase 7 skill retention is REQUIRED**: After documentation update, generate a skill retention table in `init/skill-retention-table.md` from `templates/skill-retention-table.template.md`, let user review and select skills to delete, then execute deletion via `delete-skills.cjs`. See `templates/llm-init-guide.md` Phase 7.
10. **Post-init add-on source cleanup confirmation**: After skill retention is finalized (after `approve --stage C`), ask the user whether to keep the `addons/` directory. If the user wants to remove `addons/`, run:
    - `node init/skills/initialize-project-from-requirements/scripts/init-pipeline.cjs cleanup-addons --repo-root . --apply --i-understand`

---

## Standard workflow

For detailed stage-by-stage commands, see:
- `init/stages/01-stage-a-requirements.md`
- `init/stages/02-stage-b-blueprint.md`
- `init/stages/03-stage-c-scaffold-and-skills.md`

Or use `init/README.md` for a quick start guide.

---

## Context system

See `init/addon-docs/context-awareness.md` for details on the built-in context registry system.

---

## `/addons` directory conventions (optional)

`addons/` is only for optional **non-core** capabilities (e.g. packaging/deployment/release/observability).

See:
- `init/addon-docs/convention.md`

---

## DevOps scaffold (see `init/stages/03-stage-c-scaffold-and-skills.md`)

If any of the following is true, Stage C scaffolding creates an `ops/` directory skeleton:
- `blueprint.quality.ci.enabled: true`
- `blueprint.quality.devops.*` is enabled
- `blueprint.devops.enabled: true` (or its child flags)

Typical structure:
- `ops/packaging/{services,jobs,apps,scripts,workdocs}/`
- `ops/deploy/{http_services,workloads,clients,scripts,workdocs}/`

These are intentionally placeholders (not bound to a specific cloud vendor/CI platform) so they can be extended safely later.

---

## LLM-guided initialization flow

The skill supports an LLM (AI assistant) guiding a user through the entire initialization workflow, without requiring the user to manually edit config files.

### Guidance docs

- **`templates/llm-init-guide.md`** - complete LLM guide
- **`templates/conversation-prompts.md`** - conversation question bank and branch modules

### Flow overview

```
Phase 0.5: Domain glossary alignment (optional) → Phase 1: Requirements interview
    → Phase 2: Tech stack selection → Phase 3: Blueprint generation
    → Phase 4: Add-on config (default ON) → Phase 5: Config generation + apply
    → Phase 6: Documentation update (README.md + AGENTS.md)
    → Phase 7: Skill retention confirmation
```

### Phase 0.5: Domain glossary alignment (optional, recommended)

Before starting Phase 1 (requirements interview), ask the user:

```
Before we define requirements, would you like to align on key domain terms?

This helps ensure we use consistent terminology throughout the project.
If yes, I'll help you build a domain glossary (domain-glossary.md).

[Yes / Skip for now]
```

**If user says Yes**:
1. Ask for key domain terms (3-10 terms):
   - "What are the key business/domain terms in this project?"
   - For each term: "How would you define <term>? Any synonyms or non-examples?"
2. Write to `init/stage-a-docs/domain-glossary.md`
3. Continue to Phase 1

**If user says Skip**:
- Continue to Phase 1 (`domain-glossary.md` will still be created by `start` and can be filled later)

This step is **MustAsk but not blocking** — user can skip and fill in later.

### Phase 1–4: conversation-driven guidance

The LLM should follow the question order in `conversation-prompts.md`:

1. **Module A0**: domain glossary alignment (optional, before MUST-ask)
2. **Module A**: must-ask questions (requirements, users, constraints)
3. **Module B**: branch modules (API, database, BPMN, CI)
4. **Module D**: add-on decisions (default: all enabled; ask if user wants to disable any)
5. **Module E**: tech stack selection (language, frameworks, package manager)

### Add-on default behavior

All optional add-ons (packaging, deployment, release, observability) are **enabled by default**.

The LLM should ask: "Do you want to disable any add-ons?" (opt-out model, not opt-in).

### Phase 5: config generation

#### Languages with built-in templates

For these languages, `apply` generates config automatically:

| Language | Template directory |
|----------|--------------------|
| TypeScript/JavaScript | `scaffold-configs/typescript-pnpm/` |
| Go | `scaffold-configs/go/` |
| C/C++ | `scaffold-configs/cpp-xmake/` |
| React Native | `scaffold-configs/react-native-typescript/` |

#### Languages without templates (LLM-generated)

For these languages, the LLM generates config based on `llm-init-guide.md`:

- Python → `pyproject.toml`, directory structure
- Java → `build.gradle.kts` or `pom.xml`
- Kotlin → `build.gradle.kts`
- .NET → `*.csproj`, `global.json`
- Rust → `Cargo.toml`
- Other languages → generate based on language conventions

**LLM generation flow**:

1. The `apply` command detects a missing template and prints guidance
2. The LLM uses the language/framework info from the blueprint
3. Reference `llm-init-guide.md` Phase 5
4. Generate the required config files and directory structure
5. Continue only after user confirmation

### Phase 6: documentation update confirmation (REQUIRED)

After `apply` completes successfully, the LLM **must** ask the user:

```
Would you like me to add the tech stack information to the project AGENTS.md?
```

If user agrees, update `AGENTS.md` with:
- Tech Stack table (language, package manager, frameworks, database, API style)
- Enabled Add-ons table

**Rules**:
- **Preserve existing content**: Do NOT remove Key Directories, Control Scripts, Common Tasks, Task Protocol, Rules sections
- **Insert position**: Add new sections **before** `## Key Directories`
- **LLM-first format**: Use tables, be token-efficient, keep semantic density appropriate

See `templates/llm-init-guide.md` Phase 6 for detailed template.

### Example conversation

```
AI: Let's start initializing your project. First, in one sentence, describe what the project does.

User: An inventory management system for small businesses.

AI: Got it. Who are the primary users? What must-have capabilities are required?

User: Warehouse managers. Must-have: inbound, outbound, inventory lookup, low-stock alerts.

AI: Understood. For the tech stack, what is the preferred programming language?

User: Python

AI: Python doesn't have a built-in template here, so I'll generate the config files...
[LLM generates pyproject.toml, etc. based on llm-init-guide.md]

AI: All add-ons (packaging, deployment, release, observability) are enabled by default.
Do you want to disable any?

User: No, keep all.

AI: Running apply...
[apply completes]

AI: Initialization completed. Would you like me to add the tech stack info to AGENTS.md?

User: Yes

AI: Done. AGENTS.md updated with Tech Stack and Enabled Add-ons sections.
```

---

## References

- `templates/llm-init-guide.md` - complete LLM guide
- `templates/conversation-prompts.md` - conversation question bank
- `templates/project-blueprint.schema.json` - Blueprint JSON Schema
- `templates/project-blueprint.example.json` - full example
- `templates/project-blueprint.min.example.json` - minimal example
- `reference.md` - technical reference
